name: Sistema A Scraper (Playwright)

on:
  schedule:
    # Ejecutar cada hora de lunes a viernes durante horario laboral (UTC)
    # 13:00-22:00 UTC = 7:00am-4:00pm Costa Rica (UTC-6)
    - cron: '0 13-22 * * 1-5'  # Cada hora de 7am a 4pm, lunes a viernes
  
  workflow_dispatch:  # Permitir ejecuci√≥n manual desde GitHub UI

jobs:
  scrape-and-upload:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install Python dependencies
        working-directory: sistema-ortomedica/backend
        run: |
          pip install playwright python-dotenv openpyxl mysql-connector-python
          playwright install --with-deps chromium

      - name: Run Sistema A scraper
        env:
          SISTEMA_A_USER: ${{ secrets.SISTEMA_A_USER }}
          SISTEMA_A_PASS: ${{ secrets.SISTEMA_A_PASS }}
          SISTEMA_A_BASE: https://sistema.grupoargus.co.cr
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASS: ${{ secrets.DB_PASS }}
          DB_NAME: ${{ secrets.DB_NAME }}
          DB_PORT: ${{ secrets.DB_PORT }}
        run: |
          cd sistema-ortomedica/backend
          python -m scrapers.scraper_sistema_a_xls

